import{a as e,u as s,j as l}from"./index-Babt8UfR.js";import{r,h as o}from"./vendor-react-ET7pSeaL.js";import{e as a,s as t}from"./services-P15qPlA6.js";import{h as n}from"./errorHandler-B2LE5V9y.js";import"./vendor-supabase-DKeZICmP.js";import"./vendor-ui-CCR3b1TD.js";const i=()=>{const{user:i,updatePassword:d}=e(),{setPageTitle:u}=s(),[c,m]=r.useState({name:"",role:"",email:""}),[b,x]=r.useState(""),[f,p]=r.useState(""),[h,g]=r.useState(!1),[j,v]=r.useState(null),[y,w]=r.useState(!1),N=o();r.useEffect(()=>{u("Edit Profile");let e=!0;return(async()=>{if(i){g(!0),v(null);try{const s=await a.executeQuery(()=>t.from("users").select("*").eq("id",i.id).maybeSingle());e&&s&&m({name:s.name||"",role:s.role||"",email:s.email||""})}catch(s){e&&v(a.formatError(s)),n(s,"Failed to load profile")}finally{e&&g(!1)}}})(),()=>{e=!1}},[i,u]);const S=e=>{const{name:s,value:l}=e.target;m({...c,[s]:l})};return l.jsxs("div",{className:"max-w-4xl mx-auto",children:[j&&l.jsxs("div",{className:"bg-red-900/50 border border-red-700 text-red-200 px-4 py-3 rounded-lg mb-4",role:"alert",children:[l.jsx("strong",{className:"font-bold",children:"Error!"}),l.jsxs("span",{className:"block sm:inline",children:[" ",j]})]}),y&&l.jsxs("div",{className:"bg-green-900/50 border border-green-700 text-green-200 px-4 py-3 rounded-lg mb-4",role:"alert",children:[l.jsx("strong",{className:"font-bold",children:"Success!"}),l.jsx("span",{className:"block sm:inline",children:" Profile updated successfully."})]}),l.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 lg:p-6 border border-slate-700",children:[h&&l.jsx("div",{className:"text-center text-slate-300",children:"Loading..."}),!h&&l.jsxs("form",{onSubmit:async e=>{e.preventDefault(),v(null),w(!1),g(!0);try{if(await a.executeQuery(()=>t.from("users").update({name:c.name,role:c.role,email:c.email}).eq("id",i.id)),b&&b===f)await d(b);else if(b&&b!==f)throw new Error("Passwords don't match.");w(!0),setTimeout(()=>{N("/profile",{replace:!0})},2e3)}catch(s){v(a.formatError(s)),n(s,"Failed to update profile")}finally{g(!1)}},className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-slate-300 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",id:"name",name:"name",value:c.name,onChange:S,className:"block w-full px-4 py-3 bg-slate-700 border border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-slate-300 mb-2",children:"Role"}),l.jsxs("select",{id:"role",name:"role",value:c.role,onChange:S,className:"block w-full px-4 py-3 bg-slate-700 border border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",children:[l.jsx("option",{value:"",children:"Select a role"}),l.jsx("option",{value:"Bass Guitar",children:"Bass Guitar"}),l.jsx("option",{value:"Drums",children:"Drums"}),l.jsx("option",{value:"Lead Guitar",children:"Lead Guitar"}),l.jsx("option",{value:"Rhythm Guitar",children:"Rhythm Guitar"}),l.jsx("option",{value:"Keyboard",children:"Keyboard"}),l.jsx("option",{value:"Vocals",children:"Vocals"}),l.jsx("option",{value:"Sound Engineer",children:"Sound Engineer"}),l.jsx("option",{value:"Other",children:"Other"})]})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-300 mb-2",children:"Email"}),l.jsx("input",{type:"email",id:"email",name:"email",value:c.email,onChange:S,className:"block w-full px-4 py-3 bg-slate-700 border border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-300 mb-2",children:"New Password (Optional)"}),l.jsx("input",{type:"password",id:"password",value:b,onChange:e=>{x(e.target.value)},className:"block w-full px-4 py-3 bg-slate-700 border border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-slate-300 mb-2",children:"Confirm New Password (Optional)"}),l.jsx("input",{type:"password",id:"confirmPassword",value:f,onChange:e=>{p(e.target.value)},className:"block w-full px-4 py-3 bg-slate-700 border border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]}),l.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:h?"Saving...":"Save Profile"})]})]})]})};export{i as default};
