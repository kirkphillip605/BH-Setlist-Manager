import{j as e,a as s,u as t}from"./index-Babt8UfR.js";import{r as n,h as i,i as a}from"./vendor-react-ET7pSeaL.js";import{p as l,a as r,b as c}from"./services-P15qPlA6.js";import{p as o,U as d,X as x,Z as m,E as u,s as h,r as f,F as b,M as j,A as g,d as p,I as N,J as v}from"./vendor-ui-CCR3b1TD.js";import"./vendor-supabase-DKeZICmP.js";const w=({children:s,sidebar:t,currentSong:i,currentSongLyrics:a,isLeader:l,onExit:r,onShowFollowers:c,onShowSearch:b,showSearch:j,searchContent:g,setlistName:p,currentSetName:N,isSearchSong:v,onZoomIn:w,onZoomOut:z,onResetZoom:y,lyricsZoom:S})=>{const[_,k]=n.useState(!1);return e.jsxs("div",{className:"h-screen bg-zinc-950 flex flex-col safe-area-inset-top",children:[e.jsx("div",{className:"bg-zinc-900 border-b border-zinc-800 px-4 py-3 safe-area-inset-top",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-bold text-zinc-100 truncate",children:p}),e.jsxs("p",{className:"text-sm text-zinc-400 truncate",children:[l?"ðŸ‘‘ Leader":"ðŸ‘¥ Follower"," â€¢ ",N,v&&e.jsx("span",{className:"text-amber-400",children:" â€¢ ðŸŽµ Search Song"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:b,className:"p-2 bg-amber-600 text-white rounded-xl hover:bg-amber-700 transition-colors",children:e.jsx(o,{size:20})}),e.jsx("button",{onClick:c,className:"p-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:e.jsx(d,{size:20})})]}),e.jsx("button",{onClick:r,className:"p-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors",children:e.jsx(x,{size:20})})]})]})}),j&&e.jsx("div",{className:"absolute inset-0 z-50 bg-zinc-950",children:g}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"hidden lg:flex flex-1",children:[e.jsx("div",{className:"w-80 bg-zinc-900 border-r border-zinc-800",children:t}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"h-full overflow-auto p-6 performance-zoom-container bg-zinc-950",children:e.jsx("div",{className:"lyrics-zoom-wrapper",style:{transform:`scale(${S})`,transformOrigin:"top left"},children:s})}),e.jsxs("div",{className:"absolute top-4 right-4 flex flex-col space-y-1",children:[e.jsx("button",{onClick:w,className:"p-3 bg-zinc-800/95 backdrop-blur text-zinc-300 rounded-xl hover:bg-zinc-700 transition-all shadow-lg border border-zinc-600",title:"Zoom In",children:e.jsx(m,{size:18})}),e.jsx("button",{onClick:z,className:"p-3 bg-zinc-800/95 backdrop-blur text-zinc-300 rounded-xl hover:bg-zinc-700 transition-all shadow-lg border border-zinc-600",title:"Zoom Out",children:e.jsx(u,{size:18})}),e.jsxs("button",{onClick:y,className:"px-3 py-2 bg-zinc-800/95 backdrop-blur text-zinc-300 rounded-xl hover:bg-zinc-700 transition-all shadow-lg border border-zinc-600 text-xs font-medium",title:"Reset Zoom",children:[Math.round(100*S),"%"]})]})]})]}),e.jsxs("div",{className:"hidden md:flex lg:hidden flex-1",children:[e.jsx("div",{className:"w-64 bg-zinc-900 border-r border-zinc-800",children:t}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"h-full overflow-auto p-4 performance-zoom-container bg-zinc-950",children:e.jsx("div",{className:"lyrics-zoom-wrapper",style:{transform:`scale(${S})`,transformOrigin:"top left"},children:s})}),e.jsxs("div",{className:"absolute top-4 right-4 flex space-x-1",children:[e.jsx("button",{onClick:w,className:"p-2 bg-zinc-800/95 backdrop-blur text-zinc-300 rounded-lg hover:bg-zinc-700 transition-all shadow-lg border border-zinc-600",title:"Zoom In",children:e.jsx(m,{size:16})}),e.jsx("button",{onClick:z,className:"p-2 bg-zinc-800/95 backdrop-blur text-zinc-300 rounded-lg hover:bg-zinc-700 transition-all shadow-lg border border-zinc-600",title:"Zoom Out",children:e.jsx(u,{size:16})}),e.jsxs("button",{onClick:y,className:"px-2 py-1 bg-zinc-800/95 backdrop-blur text-zinc-300 rounded-lg hover:bg-zinc-700 transition-all shadow-lg border border-zinc-600 text-xs font-medium",title:"Reset Zoom",children:[Math.round(100*S),"%"]})]})]})]}),e.jsxs("div",{className:"md:hidden flex-1 flex flex-col",children:[_?e.jsxs("div",{className:"flex-1 flex flex-col bg-zinc-950",children:[e.jsxs("div",{className:"bg-zinc-900 border-b border-zinc-800 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-bold text-zinc-100 truncate",children:i?.title}),e.jsxs("p",{className:"text-sm text-zinc-400 truncate",children:[i?.original_artist,i?.key_signature&&` â€¢ ${i.key_signature}`,null!=i?.tempo&&` â€¢ ${i.tempo} BPM`]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:w,className:"p-2 bg-zinc-800 text-zinc-300 rounded-lg hover:bg-zinc-700 transition-colors",title:"Zoom In",children:e.jsxs("div",{className:"relative",children:[e.jsx(o,{size:16}),e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] font-bold text-white",children:"+"})})]})}),e.jsx("button",{onClick:z,className:"p-2 bg-zinc-800 text-zinc-300 rounded-lg hover:bg-zinc-700 transition-colors",title:"Zoom Out",children:e.jsxs("div",{className:"relative",children:[e.jsx(o,{size:16}),e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] font-bold text-white",children:"âˆ’"})})]})}),e.jsxs("button",{onClick:y,className:"px-2 py-1 bg-zinc-800 text-zinc-300 rounded-lg hover:bg-zinc-700 transition-colors text-xs font-medium",title:"Reset Zoom",children:[Math.round(100*S),"%"]})]}),e.jsx("button",{onClick:()=>k(!1),className:"p-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors",children:e.jsx(h,{size:20})})]})]}),e.jsx("div",{className:"h-full overflow-auto p-4 performance-zoom-container bg-zinc-950",children:e.jsx("div",{className:"lyrics-zoom-wrapper",style:{transform:`scale(${S})`,transformOrigin:"top left"},children:s})})]}):e.jsx("div",{className:"flex-1 overflow-auto",children:t}),!_&&i&&e.jsx("div",{className:"bg-zinc-900 border-t border-zinc-800 p-4",children:e.jsx("button",{onClick:()=>k(!0),className:"w-full text-left p-3 bg-zinc-800 rounded-xl border border-zinc-700 hover:bg-zinc-700 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-medium text-zinc-100 truncate",children:i.title}),e.jsxs("p",{className:"text-sm text-zinc-400 truncate",children:[i.original_artist,i.key_signature&&` â€¢ ${i.key_signature}`,null!==i.tempo&&void 0!==i.tempo&&` â€¢ ${i.tempo} BPM`]})]}),e.jsx(f,{size:20,className:"text-zinc-400 ml-2"})]})})})]})]})]})},z=({isOpen:s,onClose:t,followers:n=[],sessionData:i})=>{if(!s)return null;const a=n.length+1;return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 backdrop-blur-sm transition-opacity",onClick:t}),e.jsxs("div",{className:"inline-block align-bottom bg-zinc-800 rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-zinc-800 px-6 pt-6 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-900/50",children:e.jsx(d,{className:"h-6 w-6 text-blue-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-medium text-zinc-100",children:"Session Participants"}),e.jsxs("p",{className:"text-sm text-zinc-400",children:[a," participant",1!==a?"s":""," â€¢ ",i?.setlists?.name||"Session"]})]})]}),e.jsx("button",{onClick:t,className:"text-zinc-400 hover:text-zinc-200 transition-colors p-2 mobile-action-btn",children:e.jsx(x,{size:20})})]})}),e.jsxs("div",{className:"bg-zinc-800 px-6 pb-6 max-h-96 overflow-y-auto scroll-container",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center p-3 bg-gradient-to-r from-amber-600/20 to-amber-500/10 rounded-xl border border-amber-500/30",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-amber-600 rounded-full flex items-center justify-center",children:i?.users?.name?e.jsx("span",{className:"text-white font-medium text-sm",children:i.users.name.charAt(0).toUpperCase()}):e.jsx(b,{size:20,className:"text-white"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-100",children:i?.users?.name||"Session Leader"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{size:14,className:"text-amber-400"}),e.jsx("span",{className:"text-xs text-amber-400 font-medium",children:"Leader"})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-amber-400",children:"Active"})]})]}),0===n.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{className:"h-12 w-12 text-zinc-600 mx-auto mb-3"}),e.jsx("p",{className:"text-zinc-400",children:"No followers have joined yet"}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"They will appear here when they join the session"})]}):n.map(s=>e.jsxs("div",{className:"flex items-center p-3 bg-zinc-700 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-medium text-sm",children:s.name?s.name.charAt(0).toUpperCase():"U"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-100",children:s.name||"Unknown User"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{size:14,className:"text-blue-400"}),e.jsx("span",{className:"text-xs text-blue-400 font-medium",children:"Follower"}),s.role&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-zinc-500",children:"â€¢"}),e.jsx("span",{className:"text-xs text-zinc-400",children:s.role})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-blue-400",children:"Active"})]})]},s.id))]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-zinc-700",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-xs text-zinc-500",children:["Session started ",new Date(i?.created_at).toLocaleTimeString()]}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-1",children:["Session ID: ",i?.id?.slice(-8)]})]})})]})]})]})})},y=()=>{const{user:o}=s(),{setPageTitle:m}=t(),u=i(),[h]=a(),f=h.get("setlist"),[y,S]=n.useState([]),[_,k]=n.useState(f||""),[C,L]=n.useState(!0),[D,M]=n.useState(null),[Z,I]=n.useState(!1),[F,P]=n.useState(null),[A,O]=n.useState(!1),[$,T]=n.useState(null),[R,U]=n.useState(null),[B,E]=n.useState({}),[H,J]=n.useState(null),[W,q]=n.useState(null),[G,K]=n.useState(""),[Q,V]=n.useState(!1),[X,Y]=n.useState(!1),ee=n.useRef(!0),[se,te]=n.useState(!1),[ne,ie]=n.useState(""),[ae,le]=n.useState([]),[re,ce]=n.useState(!1),[oe,de]=n.useState(null),[xe,me]=n.useState(!1),[ue,he]=n.useState([]),[fe,be]=n.useState(1);n.useEffect(()=>(ee.current=!0,m("Performance Mode"),je().then(()=>{f&&ee.current&&ge(f)}),()=>{ee.current=!1,A&&$?.id&&"standalone"!==$.id&&l.cleanupSubscriptions()}),[f]);const je=async()=>{if(ee.current){L(!0),M(null);try{const e=await r.getAllSetlists();ee.current&&S(e)}catch(e){ee.current&&M(e.message)}finally{ee.current&&L(!1)}}},ge=async e=>{if(ee.current){L(!0),M(null);try{await l.cleanupStaleSessionsForSetlist(e);const s=await l.getActiveSession(e);s?(P(s),I(!0)):(P(null),I(!0))}catch(s){ee.current&&M(s.message)}finally{ee.current&&L(!1)}}},pe=async e=>{ee.current&&(I(!1),await Ne(_||f,e,F))},Ne=async(e,s,t=null)=>{if(ee.current){L(!0),M(null);try{let i=t,a=!1,r=!1;if("standalone"===s)await l.prefetchAndCacheSetlistData(e),i={id:"standalone",setlist_id:e},r=!0,a=!0;else if("leader"===s){if(t&&t.leader_id===o.id)i=t;else if(t&&o.user_level>=3)i=await l.takeOverLeadership(t.id,o.id);else{if(t)throw new Error("Cannot take leadership - another user is currently leading");i=await l.createSession(e,o.id)}a=!0}else{if("follower"!==s||!t)throw new Error("Invalid role or missing session data");await l.joinAsFollower(t.id,o.id),i=t,a=!1}if(ee.current&&i){T(i),V(a),Y(r);try{localStorage.setItem("performanceMode_sessionId",i.id),localStorage.setItem("performanceMode_isLeader",a.toString())}catch(n){}await ve(e,i),r||"standalone"===i.id||(l.subscribeToSession(i.id,Se),l.subscribeToParticipants(i.id,_e),await ye(i.id)),await ze(),O(!0),l.setActive(!0)}}catch(i){ee.current&&M(i.message)}finally{ee.current&&L(!1)}}},ve=async(e,s)=>{if(ee.current)try{const{setlistData:t,songsData:n}=l.getCachedSetlistData();if(t&&Object.keys(n).length>0)ee.current&&(U(t),E(n));else{await l.prefetchAndCacheSetlistData(e);const{setlistData:s,songsData:t}=l.getCachedSetlistData();ee.current&&(U(s),E(t))}const{setlistData:i}=l.getCachedSetlistData();if(s&&"standalone"!==s.id){if(s.current_set_id){const e=i?.sets?.find(e=>e.id===s.current_set_id);ee.current&&e&&J(e)}s.current_song_id&&await we(s.current_song_id)}ee.current&&!H&&i?.sets?.[0]&&(J(i.sets[0]),i.sets[0].set_songs?.[0]&&await we(i.sets[0].set_songs[0].songs.id))}catch(t){ee.current&&M(t.message)}},we=async e=>{if(ee.current&&e)try{const s=l.getCachedSetlistData().songsData;if(s[e])ee.current&&(q(s[e]),K(s[e].lyrics),ce(!1));else{const s=await c.getSongById(e);ee.current&&(q(s),K(s.lyrics),ce(!1))}}catch(s){}},ze=async()=>{try{const e=await c.getAllSongs();ee.current&&le(e)}catch(e){}},ye=async e=>{if(e&&"standalone"!==e)try{const s=await l.getSessionFollowers(e);ee.current&&he(s)}catch(s){}},Se=e=>{if(!ee.current||!e?.new||X)return;const s=e.new;setTimeout(async()=>{if(!ee.current)return;T(e=>({...e,...s}));const e=$?.leader_id===o.id,t=s.leader_id===o.id;!e&&t?(V(!0),localStorage.setItem("performanceMode_isLeader","true")):e&&!t&&(V(!1),localStorage.setItem("performanceMode_isLeader","false")),s.current_song_id&&s.current_song_id!==W?.id&&await we(s.current_song_id),s.current_set_id&&s.current_set_id!==H?.id&&await ke(s.current_set_id)},0)},_e=async e=>{ee.current&&$&&"standalone"!==$.id&&await ye($.id)},ke=async e=>{if(ee.current)try{const s=l.getCachedSetlistData().setlistData,t=s?.sets?.find(s=>s.id===e);ee.current&&t&&J(t)}catch(s){}},Ce=()=>{if(!H||!W||re)return-1;return(H.set_songs?.map(e=>e.songs).sort((e,s)=>(H.set_songs.find(s=>s.songs.id===e.id)?.song_order||0)-(H.set_songs.find(e=>e.songs.id===s.id)?.song_order||0))||[]).findIndex(e=>e.id===W.id)},Le=async()=>{try{Q&&$&&"standalone"!==$.id?await l.endSession($.id):$&&"standalone"!==$.id&&await l.leaveSession($.id,o.id),l.cleanupSubscriptions(),u("/setlists")}catch(e){u("/setlists")}},De=async()=>{$&&"standalone"!==$.id&&await ye($.id),me(!0)},Me=()=>{be(e=>Math.min(2,e+.1))},Ze=()=>{be(e=>Math.max(.8,e-.1))},Ie=()=>{be(1)},Fe=ae.filter(e=>e.title.toLowerCase().includes(ne.toLowerCase())||e.original_artist.toLowerCase().includes(ne.toLowerCase()));if(Z&&!C&&(_||f)){const s=F&&F.leader_id,t=o.user_level>=3,n=F?.users?.name||"Unknown",i=F?.leader_id===o.id;return e.jsx("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center px-4",children:e.jsxs("div",{className:"card-modern p-6 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(b,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-zinc-100",children:"Performance Mode"}),e.jsx("p",{className:"text-zinc-300 mt-2",children:"How would you like to enter performance mode?"}),F&&e.jsxs("div",{className:"mt-4 p-3 bg-zinc-800 rounded-xl",children:[e.jsxs("p",{className:"text-sm text-zinc-400",children:["Current leader: ",e.jsx("span",{className:"text-zinc-300 font-medium",children:n})]}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-1",children:["Session started: ",new Date(F.created_at).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"space-y-3",children:[i?e.jsxs("button",{onClick:()=>pe("leader"),className:"w-full inline-flex items-center justify-center px-6 py-4 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(b,{size:20,className:"mr-2"}),"Rejoin as Leader"]}):s?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>pe("follower"),className:"w-full inline-flex items-center justify-center px-6 py-4 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors font-medium",children:[e.jsx(d,{size:20,className:"mr-2"}),"Join as Follower"]}),t&&e.jsxs("button",{onClick:()=>pe("leader"),className:"w-full inline-flex items-center justify-center px-6 py-4 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors font-medium",children:[e.jsx(b,{size:20,className:"mr-2"}),"Take Over as Leader (Admin)"]})]}):e.jsx("div",{className:"space-y-3",children:e.jsxs("button",{onClick:()=>pe("leader"),className:"w-full inline-flex items-center justify-center px-6 py-4 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(b,{size:20,className:"mr-2"}),"Start as Leader"]})}),e.jsxs("div",{className:"pt-4 border-t border-zinc-700",children:[e.jsxs("button",{onClick:()=>pe("standalone"),className:"w-full inline-flex items-center justify-center px-6 py-4 bg-zinc-600 text-white rounded-xl hover:bg-zinc-500 transition-colors font-medium",children:[e.jsx(j,{size:20,className:"mr-2"}),"Standalone Mode"]}),e.jsx("p",{className:"text-xs text-zinc-500 text-center mt-2",children:"Practice mode without sharing with others"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{I(!1),k(""),P(null);const e=new URL(window.location);e.searchParams.delete("setlist"),window.history.replaceState({},"",e)},className:"text-zinc-400 hover:text-zinc-300 transition-colors text-sm",children:"â† Choose Different Setlist"})})]})]})})}if(C)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-zinc-950",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-300",children:f?"Checking session status...":"Loading setlists..."})]})});if(D)return e.jsx("div",{className:"min-h-screen bg-zinc-950 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"card-modern p-6 w-full max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(x,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h2",{className:"text-xl font-bold text-zinc-100 mb-4",children:"Error"}),e.jsx("p",{className:"text-zinc-300 mb-6",children:D}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{M(null),I(!1),f?ge(f):je()},className:"w-full inline-flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:"Try Again"}),e.jsx("button",{onClick:()=>u("/setlists"),className:"w-full text-zinc-400 hover:text-zinc-300 transition-colors",children:"â† Back to Setlists"})]})]})});if(!A&&!Z)return e.jsx("div",{className:"min-h-screen bg-zinc-950 p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("button",{onClick:()=>u("/setlists"),className:"p-2 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800 rounded-xl transition-all btn-animate",children:e.jsx(g,{size:20})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/10 rounded-2xl flex items-center justify-center",children:e.jsx(p,{className:"h-6 w-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-zinc-100",children:"Performance Mode"}),e.jsx("p",{className:"text-zinc-400",children:"Choose a setlist to perform"})]})]})]})}),e.jsxs("div",{className:"card-modern p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"setlist-select",className:"block text-sm font-medium text-zinc-300 mb-3",children:"Select Setlist"}),e.jsxs("select",{id:"setlist-select",value:_,onChange:e=>k(e.target.value),className:"input-modern",children:[e.jsx("option",{value:"",children:"Choose a setlist..."}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>(async e=>{if(!e)return void M("Please select a setlist");k(e);const s=new URL(window.location);s.searchParams.set("setlist",e),window.history.replaceState({},"",s),await ge(e)})(_),disabled:!_||C,className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all btn-animate shadow-lg font-medium",children:[e.jsx(p,{size:20,className:"mr-2"}),"Continue"]})})]})]})});const Pe=H?.set_songs?.map(e=>e.songs).sort((e,s)=>(H.set_songs.find(s=>s.songs.id===e.id)?.song_order||0)-(H.set_songs.find(e=>e.songs.id===s.id)?.song_order||0))||[],Ae=Ce(),Oe=Ae>0&&!re||re&&oe,$e=Ae<Pe.length-1&&!re||re&&oe,Te=e.jsxs("div",{className:"h-full flex flex-col",children:[(Q||X)&&R?.sets&&R.sets.length>1&&e.jsxs("div",{className:"p-4 border-b border-zinc-800",children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-2",children:"Current Set"}),e.jsx("select",{value:H?.id||"",onChange:e=>{const s=R.sets.find(s=>s.id===e.target.value);s&&(async e=>{if((Q||X)&&$)try{const s=e.set_songs?.[0]?.songs;"standalone"!==$.id&&await l.updateSession($.id,{current_set_id:e.id,current_song_id:s?.id||null}),ee.current&&(J(e),ce(!1),s&&await we(s.id))}catch(s){ee.current&&M(s.message)}})(s)},className:"input-modern text-sm",children:R.sets.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:Pe.map((s,t)=>e.jsx("button",{onClick:()=>(Q||X)&&!re&&(async e=>{if((Q||X)&&$)try{"standalone"!==$.id&&await l.updateSession($.id,{current_song_id:e.id}),ee.current&&(await we(e.id),ce(!1))}catch(s){ee.current&&M(s.message)}})(s),disabled:!Q&&!X||re,className:`w-full text-left p-3 rounded-xl transition-all ${W?.id!==s.id||re?!Q&&!X||re?"bg-zinc-800 text-zinc-300 cursor-default":"bg-zinc-800 text-zinc-300 hover:bg-zinc-700 hover:text-zinc-100":"bg-blue-600 text-white shadow-lg"} ${re?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium "+(W?.id!==s.id||re?"bg-zinc-700 text-zinc-400":"bg-blue-500 text-white"),children:t+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.title}),e.jsxs("p",{className:"text-xs opacity-75 truncate",children:[s.original_artist,s.key_signature&&` â€¢ ${s.key_signature}`,null!==s.tempo&&void 0!==s.tempo&&` â€¢ ${s.tempo} BPM`]}),s.performance_note&&e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx("svg",{className:"w-3 h-3 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),e.jsx("span",{className:"text-amber-300 text-xs",children:s.performance_note})]})]})]})},s.id))}),(Q||X)&&e.jsx("div",{className:"p-4 border-t border-zinc-800 space-y-3 safe-area-inset-bottom",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:async()=>{if(!Q&&!X||!$)return;if(re&&oe)return"standalone"!==$.id&&await l.updateSession($.id,{current_song_id:oe.id}),await we(oe.id),void de(null);if(!H)return;const e=H.set_songs?.map(e=>e.songs).sort((e,s)=>(H.set_songs.find(s=>s.songs.id===e.id)?.song_order||0)-(H.set_songs.find(e=>e.songs.id===s.id)?.song_order||0))||[],s=Ce();if(s>0){const t=e[s-1];"standalone"!==$.id&&await l.updateSession($.id,{current_song_id:t.id}),await we(t.id)}},disabled:!Oe,className:"flex-1 inline-flex items-center justify-center px-4 py-3 bg-zinc-700 text-zinc-300 rounded-xl hover:bg-zinc-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:[e.jsx(N,{size:18,className:"mr-2"}),"Previous"]}),e.jsxs("button",{onClick:async()=>{if(!Q&&!X||!$)return;if(re&&oe)return"standalone"!==$.id&&await l.updateSession($.id,{current_song_id:oe.id}),await we(oe.id),void de(null);if(!H)return;const e=H.set_songs?.map(e=>e.songs).sort((e,s)=>(H.set_songs.find(s=>s.songs.id===e.id)?.song_order||0)-(H.set_songs.find(e=>e.songs.id===s.id)?.song_order||0))||[],s=Ce();if(s<e.length-1){const t=e[s+1];"standalone"!==$.id&&await l.updateSession($.id,{current_song_id:t.id}),await we(t.id)}},disabled:!$e,className:"flex-1 inline-flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:["Next",e.jsx(v,{size:18,className:"ml-2"})]})]})})]}),Re=e.jsxs("div",{className:"h-full flex flex-col bg-zinc-950",children:[e.jsx("div",{className:"bg-zinc-900 border-b border-zinc-800 px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>te(!1),className:"p-2 text-zinc-400 hover:text-zinc-200",children:e.jsx(x,{size:20})}),e.jsx("input",{type:"text",placeholder:"Search songs...",value:ne,onChange:e=>ie(e.target.value),className:"flex-1 px-4 py-2 bg-zinc-800 border border-zinc-700 text-zinc-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"space-y-2",children:Fe.slice(0,50).map(s=>e.jsx("button",{onClick:()=>(Q||X)&&(async e=>{if(ee.current)try{ee.current&&de(W);let s=B[e.id]||e;s.lyrics||(s=await c.getSongById(e.id)),(Q||X)&&$&&"standalone"!==$.id&&await l.updateSession($.id,{current_song_id:s.id}),ee.current&&(q(s),K(s.lyrics),ce(!0),te(!1),ie(""))}catch(s){ee.current&&M("Failed to load selected song")}})(s),disabled:!Q&&!X,className:"w-full text-left p-3 rounded-xl transition-all "+(Q||X?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700 hover:text-zinc-100":"bg-zinc-800 text-zinc-300 cursor-default opacity-50"),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.title}),e.jsxs("p",{className:"text-xs opacity-75 truncate",children:[s.original_artist,s.key_signature&&` â€¢ ${s.key_signature}`,null!==s.tempo&&void 0!==s.tempo&&` â€¢ ${s.tempo} BPM`]})]})},s.id))})})]}),Ue=e.jsx("div",{className:"h-full flex flex-col",children:W?e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"prose prose-invert prose-lg max-w-none text-zinc-200 leading-relaxed",dangerouslySetInnerHTML:{__html:G}})})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"h-16 w-16 text-zinc-600 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-zinc-400",children:"No song selected"})]})})});return A?e.jsxs(e.Fragment,{children:[e.jsx(w,{sidebar:Te,currentSong:W,currentSongLyrics:G,isLeader:Q||X,onExit:Le,onShowFollowers:De,onShowSearch:()=>te(!0),showSearch:se,searchContent:Re,setlistName:R?.name,currentSetName:H?.name,isSearchSong:re,onZoomIn:Me,onZoomOut:Ze,onResetZoom:Ie,lyricsZoom:fe,children:Ue}),e.jsx(z,{isOpen:xe,onClose:()=>me(!1),followers:ue,sessionData:$})]}):null};export{y as default};
