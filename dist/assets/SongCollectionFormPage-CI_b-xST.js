import{a as e,u as s,j as l}from"./index-Babt8UfR.js";import{l as t,h as o,r as n}from"./vendor-react-ET7pSeaL.js";import{c as a}from"./services-P15qPlA6.js";import{S as i}from"./SongSelectorModal-DQDBqQYu.js";import{D as r}from"./DraggableList-C0Rm0Xlq.js";import{j as c,t as d,M as m}from"./vendor-ui-CCR3b1TD.js";import"./vendor-supabase-DKeZICmP.js";const u=()=>{const{collectionId:u}=t(),{user:x}=e(),{setPageTitle:g}=s(),b=o(),[p,h]=n.useState(!1),[j,f]=n.useState(null),[N,v]=n.useState(""),[y,S]=n.useState(!1),[C,w]=n.useState([]),[_,k]=n.useState(!1),E=!!u;n.useEffect(()=>{E?(g("Edit Song Collection"),F()):(g("New Song Collection"),v(""),w([]))},[u,E,g]);const F=async()=>{h(!0),f(null);try{const e=await a.getSongCollectionById(u);v(e.name),S(e.is_public||!1);const s=e.song_collection_songs?.map(e=>({...e.songs,song_order:e.song_order})).sort((e,s)=>e.song_order-s.song_order)||[];w(s)}catch(e){f(e.message||"Failed to load song collection")}finally{h(!1)}},z=e=>e.map((e,s)=>({...e,song_order:s+1}));return p&&E?l.jsx("div",{className:"max-w-4xl mx-auto",children:l.jsx("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:l.jsx("p",{className:"text-center text-slate-300",children:"Loading collection..."})})}):l.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[j&&l.jsxs("div",{className:"bg-red-900/50 border border-red-700 text-red-200 px-4 py-3 rounded-lg",children:[l.jsx("strong",{className:"font-bold",children:"Error!"}),l.jsxs("span",{className:"block sm:inline",children:[" ",j]})]}),l.jsx("div",{className:"bg-slate-800 rounded-xl p-4 lg:p-6 border border-slate-700",children:l.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),N.trim()){h(!0),f(null);try{const e={name:N,user_id:x.id,is_public:y,songs:C.map(e=>({song_id:e.id,song_order:e.song_order}))};if(E)await a.updateSongCollection(u,e),b(`/song-collections/${u}`);else{const s=await a.createSongCollection(e);b(`/song-collections/edit/${s.id}`)}}catch(s){f(s.message||"Failed to save song collection")}finally{h(!1)}}else f("Collection name is required")},className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"collectionName",className:"block text-sm font-medium text-slate-300 mb-2",children:"Collection Name"}),l.jsx("input",{type:"text",id:"collectionName",value:N,onChange:e=>v(e.target.value),className:"block w-full px-4 py-3 bg-slate-700 border border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter collection name...",required:!0})]}),l.jsxs("div",{className:"flex items-center",children:[l.jsx("input",{id:"isPublic",type:"checkbox",checked:y,onChange:e=>S(e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-600 rounded bg-slate-700"}),l.jsx("label",{htmlFor:"isPublic",className:"ml-2 block text-sm text-slate-300",children:"Make this collection public (visible to all users)"})]}),l.jsxs("div",{className:"flex justify-end space-x-3",children:[l.jsxs("button",{type:"button",onClick:()=>{b("/song-collections")},className:"inline-flex items-center px-4 py-2 border border-slate-600 rounded-lg text-slate-300 bg-slate-700 hover:bg-slate-600 transition-colors",children:[l.jsx(c,{size:18,className:"mr-2"}),"Cancel"]}),l.jsxs("button",{type:"submit",disabled:p||!N.trim(),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[l.jsx(d,{size:18,className:"mr-2"}),p?"Saving...":E?"Update Collection":"Create Collection"]})]})]})}),l.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 lg:p-6 border border-slate-700",children:[l.jsxs("div",{className:"flex justify-between items-center mb-6",children:[l.jsx("h3",{className:"text-lg font-medium text-slate-100",children:"Songs in Collection"}),l.jsxs("button",{onClick:()=>k(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[l.jsx(m,{size:18,className:"mr-2"}),"Add Songs"]})]}),0===C.length?l.jsxs("div",{className:"text-center py-8",children:[l.jsx(m,{className:"mx-auto h-12 w-12 text-slate-400 mb-4"}),l.jsx("p",{className:"text-slate-300 text-lg mb-2",children:"No songs in collection"}),l.jsx("p",{className:"text-slate-400",children:"Add songs to build your collection"})]}):l.jsx(r,{items:C,onReorder:(e,s)=>{w(l=>{const t=[...l],[o]=t.splice(e,1);return t.splice(s,0,o),z(t)})},onRemove:e=>{w(s=>z(s.filter((s,l)=>l!==e)))},type:"songs"})]}),l.jsx(i,{isOpen:_,onClose:()=>k(!1),onSongsSelected:e=>{const s=new Set(C.map(e=>e.id)),l=e.filter(e=>!s.has(e.id));l.length>0&&w(e=>z([...e,...l])),k(!1)},selectedSongs:C})]})};export{u as default};
