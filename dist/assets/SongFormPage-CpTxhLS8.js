import{j as e,u as s,a as t}from"./index-Babt8UfR.js";import{a,h as i,l as n,r}from"./vendor-react-ET7pSeaL.js";import{r as l}from"./vendor-editor-D5iEGL9y.js";import{b as o}from"./services-P15qPlA6.js";import{A as c,j as m,t as d}from"./vendor-ui-CCR3b1TD.js";import"./vendor-supabase-DKeZICmP.js";const x=a(l()),u=({title:s,subtitle:t,onBack:a,children:n,actions:r,loading:l=!1})=>{const o=i();return e.jsx("div",{className:"min-h-screen bg-zinc-950 safe-area-inset-top",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-zinc-950/95 backdrop-blur border-b border-zinc-800 p-4 sm:p-6 safe-area-inset-top",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{a?a():o(-1)},className:"mobile-action-btn flex items-center justify-center",disabled:l,children:e.jsx(c,{size:24,className:"text-zinc-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-zinc-100 truncate",children:s}),t&&e.jsx("p",{className:"text-sm sm:text-base text-zinc-400 truncate",children:t})]})]})}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-6 safe-area-inset-bottom",children:[n,r&&e.jsx("div",{className:"sticky bottom-0 bg-zinc-950/95 backdrop-blur border-t border-zinc-800 -mx-4 sm:-mx-6 px-4 sm:px-6 py-4 safe-area-inset-bottom",children:e.jsx("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3",children:r})})]})]})})},b=["C Major","G Major","D Major","A Major","E Major","B Major","F# Major","C# Major","F Major","Bb Major","Eb Major","Ab Major","Db Major","Gb Major","Cb Major","A Minor","E Minor","B Minor","F# Minor","C# Minor","G# Minor","D# Minor","A# Minor","D Minor","G Minor","C Minor","F Minor","Bb Minor","Eb Minor","Ab Minor"],p=()=>{const{songId:a}=n(),{setPageTitle:l}=s(),{user:c}=t(),p=i(),[g,j]=r.useState(!1),[h,f]=r.useState(null),[y,N]=r.useState({original_artist:"",title:"",key_signature:"",tempo:"",performance_note:"",lyrics:""}),v=r.useMemo(()=>!!a,[a]);r.useEffect(()=>{(!c||c.user_level<2)&&p("/songs")},[c,p]),r.useEffect(()=>{if(v){(async()=>{l("Edit Song"),j(!0),f(null);try{const e=await o.getSongById(a);N({original_artist:e.original_artist,title:e.title,key_signature:e.key_signature,tempo:e.tempo??"",performance_note:e.performance_note||"",lyrics:e.lyrics})}catch(e){f(e.message||"Failed to load song for editing. Please try again.")}finally{j(!1)}})()}else l("Add New Song"),N({original_artist:"",title:"",key_signature:"",tempo:"",performance_note:"",lyrics:""})},[a,v,l]);const M=e=>{const{name:s,value:t}=e.target;N(e=>({...e,[s]:t}))},k=r.useMemo(()=>({toolbar:[[{header:[1,2,!1]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],["link","image"],["clean"]]}),[]);if(!c||c.user_level<2)return null;if(g&&v)return e.jsx(u,{title:v?"Edit Song":"Add Song",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-300",children:"Loading song data..."})]})});const z=e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>{p(v?`/songs/${a}`:"/songs")},disabled:g,className:"w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 border border-zinc-600 rounded-xl text-zinc-300 bg-zinc-700 hover:bg-zinc-600 transition-colors mobile-form-button",children:[e.jsx(m,{size:20,className:"mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",form:"song-form",disabled:g,className:"w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors mobile-form-button",children:[e.jsx(d,{size:20,className:"mr-2"}),g?"Saving...":"Save Song"]})]});return e.jsxs(u,{title:v?"Edit Song":"Add Song",subtitle:v?`Editing: ${y.title}`:"Add a new song to your library",actions:z,loading:g,children:[h&&e.jsxs("div",{className:"bg-red-900/50 border border-red-700 text-red-200 px-4 py-3 rounded-lg mb-4",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",h]})]}),e.jsx("div",{className:"card-modern p-4 sm:p-6",children:e.jsxs("form",{id:"song-form",onSubmit:async e=>{e.preventDefault(),j(!0),f(null);try{v?await o.updateSong(a,y):await o.createSong(y),p(v?`/songs/${a}`:"/songs")}catch(s){f(s.message||"Failed to save song. Please try again.")}finally{j(!1)}},className:"grid grid-cols-1 md:grid-cols-12 gap-6 sm:gap-4 mobile-form-grid",children:[e.jsxs("div",{className:"md:col-span-6",children:[e.jsx("label",{htmlFor:"title",className:"block text-base sm:text-sm font-medium text-zinc-300 mb-3 sm:mb-2",children:"Title"}),e.jsx("input",{type:"text",id:"title",name:"title",value:y.title,onChange:M,className:"input-modern",required:!0})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx("label",{htmlFor:"original_artist",className:"block text-base sm:text-sm font-medium text-zinc-300 mb-3 sm:mb-2",children:"Original Artist"}),e.jsx("input",{type:"text",id:"original_artist",name:"original_artist",value:y.original_artist,onChange:M,className:"input-modern",required:!0})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{htmlFor:"key_signature",className:"block text-base sm:text-sm font-medium text-zinc-300 mb-3 sm:mb-2",children:"Key Signature (Optional)"}),e.jsx("input",{type:"text",id:"key_signature",name:"key_signature",value:y.key_signature,onChange:M,list:"key-signatures",className:"input-modern"}),e.jsx("datalist",{id:"key-signatures",children:b.map(s=>e.jsx("option",{value:s},s))})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{htmlFor:"tempo",className:"block text-base sm:text-sm font-medium text-zinc-300 mb-3 sm:mb-2",children:"Tempo (BPM)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",id:"tempo",name:"tempo",value:y.tempo,onChange:M,className:"input-modern pr-16",placeholder:"e.g., 120",min:"0",inputMode:"numeric"}),e.jsx("span",{className:"absolute inset-y-0 right-4 flex items-center text-sm font-medium text-zinc-400 pointer-events-none",children:"BPM"})]})]}),e.jsxs("div",{className:"md:col-span-12",children:[e.jsx("label",{htmlFor:"performance_note",className:"block text-base sm:text-sm font-medium text-zinc-300 mb-3 sm:mb-2",children:"Performance Note (Optional)"}),e.jsx("input",{type:"text",id:"performance_note",name:"performance_note",value:y.performance_note,onChange:M,className:"input-modern",placeholder:"e.g., Change guitars, Solo by John..."})]}),e.jsxs("div",{className:"col-span-1 md:col-span-12",children:[e.jsx("label",{htmlFor:"lyrics",className:"block text-base sm:text-sm font-medium text-zinc-300 mb-3 sm:mb-2",children:"Lyrics (Rich Text Editor)"}),e.jsx(x,{theme:"snow",value:y.lyrics,onChange:e=>{N(s=>({...s,lyrics:e}))},modules:k,formats:["header","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image"],placeholder:"Enter lyrics here...",className:"bg-zinc-700 text-zinc-100 border-zinc-600"})]})]})})]})};export{p as default};
